<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>ØªØ´Ø®ÛŒØµ Ø¨Ø§ ÙˆØ¨â€ŒÚ©Ù…</title>
</head>
<body style="text-align:center; font-family: sans-serif;">
  <h2>ðŸŸ¢ Ø³ÛŒØ³ØªÙ… ØªØ´Ø®ÛŒØµ Ø§Ø´ÛŒØ§Ø¡ Ø¨Ø§ ÙˆØ¨â€ŒÚ©Ù…</h2>
  
  <!-- Ù†Ù…Ø§ÛŒØ´ ÙˆÛŒØ¯ÛŒÙˆ Ø§Ø² ÙˆØ¨â€ŒÚ©Ù… -->
  <video id="video" width="400" autoplay></video><br>

  <!-- Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙØªÙ† Ø¹Ú©Ø³ -->
  <button onclick="captureAndDetect()">ðŸ“¸ Ø¹Ú©Ø³ Ø¨Ú¯ÛŒØ±</button><br><br>

  <!-- Ù†Ù…Ø§ÛŒØ´ ØªØµÙˆÛŒØ± ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ -->
  <img id="resultImage" width="400"><br>

  <!-- Ù†Ù…Ø§ÛŒØ´ Ù†Ø§Ù… Ø§Ø´ÛŒØ§Ø¡ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒâ€ŒØ´Ø¯Ù‡ -->
  <p id="labels" style="font-size: 20px;"></p>

  <script>
    // Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ ÙˆØ¨â€ŒÚ©Ù…
    const video = document.getElementById("video");
    const canvas = document.createElement("canvas");

    // Ú¯Ø±ÙØªÙ† ÙˆÛŒØ¯ÛŒÙˆ Ø§Ø² ÙˆØ¨â€ŒÚ©Ù…
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => {
        video.srcObject = stream;
      });

    // Ø²Ù…Ø§Ù†ÛŒ Ú©Ù‡ Ø¯Ú©Ù…Ù‡ Ø¹Ú©Ø³ Ú¯Ø±ÙØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
    function captureAndDetect() {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      canvas.getContext("2d").drawImage(video, 0, 0);
      const dataURL = canvas.toDataURL("image/jpeg");

      // Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ
      fetch("/detect", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ image: dataURL })
      })
      .then(response => response.json())
      .then(data => {
        // Ù†Ù…Ø§ÛŒØ´ ØªØµÙˆÛŒØ± Ùˆ Ù†ØªØ§ÛŒØ¬ ØªØ´Ø®ÛŒØµ
        document.getElementById("resultImage").src = data.image;
        document.getElementById("labels").innerText = "Ø§Ø´ÛŒØ§Ø¡ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒâ€ŒØ´Ø¯Ù‡: " + data.labels.join(", ");
      });
    }
  </script>
</body>
</html>
